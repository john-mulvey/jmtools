% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gsea.R
\name{cluster_enrichment_results}
\alias{cluster_enrichment_results}
\title{Cluster enrichment results by gene overlap similarity}
\usage{
cluster_enrichment_results(
  enrichment_results,
  gene_set_col = "gene_set",
  score_col = "nes",
  adj_pval_col = "adj_p_value",
  genes_col = "leading_edge",
  n_genes_col = "n_genes",
  adj_p_threshold = 0.05,
  similarity_threshold = 0.3,
  similarity_metric = c("jaccard", "overlap")
)
}
\arguments{
\item{enrichment_results}{Data frame of enrichment results from GSEA or ORA,
typically with cleaned column names from the boilerplate functions.}

\item{gene_set_col}{Character string specifying the column containing gene
set names. Default: \code{"gene_set"}.}

\item{score_col}{Character string specifying the column containing the
enrichment score (NES for GSEA, enrichment_score for ORA). Default: \code{"nes"}.
For ORA results, use \code{"enrichment_score"}.}

\item{adj_pval_col}{Character string specifying the column containing
adjusted p-values for filtering. Default: \code{"adj_p_value"}.}

\item{genes_col}{Character string specifying the column containing the
genes driving enrichment (as a list column). For GSEA use \code{"leading_edge"},
for ORA use \code{"overlap_genes"}. Default: \code{"leading_edge"}.}

\item{n_genes_col}{Character string specifying the column containing the
number of genes in each gene set. Default: \code{"n_genes"}. For ORA results,
use \code{"n_gene_set"}.}

\item{adj_p_threshold}{Adjusted p-value threshold for filtering gene sets.
Default: 0.05.}

\item{similarity_threshold}{Minimum similarity to consider two gene
sets as belonging to the same cluster. Default: 0.3.}

\item{similarity_metric}{Character string specifying which similarity metric
to use. One of \code{"jaccard"} (Jaccard index) or \code{"overlap"} (overlap
coefficient / Szymkiewicz-Simpson). The overlap coefficient is less
sensitive to differences in set size, making it better suited for
hierarchically-related gene sets. Default: \code{"jaccard"}.}
}
\value{
A data frame containing all significant gene sets (one row per gene
set) with added columns:
\describe{
\item{cluster}{Integer cluster ID}
\item{cluster_label}{Representative name for the cluster (the gene set
with the largest number of genes in that cluster)}
}
}
\description{
Clusters significant gene sets based on similarity of their
overlapping genes. Works with both GSEA results (using leading edge genes)
and ORA results (using overlap genes). Returns the input data frame with
added cluster information.
}
\details{
Clustering is performed using the Walktrap algorithm, which detects
communities based on random walks through the similarity network. Gene sets
that are densely connected (high Jaccard similarity) tend to end up in the
same cluster. This method can identify meaningful subcommunities even within
connected components.

The cluster label is the name of the gene set with the largest number of
genes in that cluster.

Only gene sets meeting the significance threshold are returned. Non-significant
gene sets are excluded from the output.

This function works with both GSEA and ORA results:
\itemize{
\item \strong{GSEA}: Use \code{genes_col = "leading_edge"}, \code{score_col = "nes"},
\code{n_genes_col = "n_genes"}
\item \strong{ORA}: Use \code{genes_col = "overlap_genes"}, \code{score_col = "enrichment_score"},
\code{n_genes_col = "n_gene_set"}
}
}
\examples{
\dontrun{
# Cluster GSEA results
clustered_gsea <- cluster_enrichment_results(gsea_results)

# Cluster ORA results (note different column names)
clustered_ora <- cluster_enrichment_results(
  ora_results,
  score_col = "enrichment_score",
  genes_col = "overlap_genes",
  n_genes_col = "n_gene_set"
)

# View cluster assignments
head(clustered_gsea[, c("gene_set", "nes", "cluster", "cluster_label")])

# Plot as bar chart
plot_enrichment_bars(clustered_gsea)
}

}
\seealso{
\code{\link[=plot_enrichment_bars]{plot_enrichment_bars()}} for plotting clustered results
}
