% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/eda.R
\name{test_pc_metadata_associations}
\alias{test_pc_metadata_associations}
\title{Test associations between principal components and metadata}
\usage{
test_pc_metadata_associations(
  pca_result,
  metadata,
  vars_to_test,
  id_col = "sample_id",
  n_pcs = 5,
  min_var_explained = 0,
  min_complete_pct = 0.7,
  p_adjust_method = "BH"
)
}
\arguments{
\item{pca_result}{A \code{prcomp} object from \code{\link[stats:prcomp]{stats::prcomp()}}. The function
extracts scores from \code{pca_result$x} and variance explained from
\code{pca_result$sdev}.}

\item{metadata}{Data frame containing metadata variables to test.}

\item{vars_to_test}{Character vector of variable names from \code{metadata} to
test for association with PCs.}

\item{id_col}{Name of the column containing sample identifiers. Must be
present in \code{metadata} and match the rownames of \code{pca_result$x}.}

\item{n_pcs}{Maximum number of principal components to test (default: 5).}

\item{min_var_explained}{Minimum percentage of variance a PC must explain
to be included (default: 0). Set to a positive value (e.g., 5) to only
test PCs explaining meaningful variance.}

\item{min_complete_pct}{Minimum proportion of non-missing values required
for a variable to be tested (default: 0.7, i.e., 70\%).}

\item{p_adjust_method}{Method for p-value adjustment. See \code{\link[stats:p.adjust]{stats::p.adjust()}}
for options (default: "BH" for Benjamini-Hochberg).}
}
\value{
A data frame with columns:
\describe{
\item{variable}{Name of the metadata variable}
\item{principal_component}{Name of the principal component (e.g., "PC1")}
\item{test_type}{Statistical test used ("Spearman" or "Kruskal-Wallis")}
\item{statistic}{Effect size: Spearman's rho for continuous variables,
eta-squared for categorical variables}
\item{p_value}{Raw p-value from the statistical test}
\item{n}{Number of complete observations used}
\item{p_adj}{Adjusted p-value using the specified method}
}
}
\description{
Tests associations between PCA coordinates and metadata variables using
appropriate statistical tests: Spearman correlation for continuous variables
and Kruskal-Wallis test for categorical variables.
}
\details{
For continuous variables, Spearman's rank correlation is used, which is
robust to non-normality and outliers. For categorical variables (factors
or character vectors), the Kruskal-Wallis test is used with eta-squared
as the effect size measure.

Variables with more than \code{1 - min_complete_pct} proportion of missing
values are automatically excluded from testing.
}
\examples{
\dontrun{
# Run PCA with prcomp
pca_result <- prcomp(t(expr_matrix), scale. = TRUE, center = TRUE)

# Test associations
associations <- test_pc_metadata_associations(
  pca_result = pca_result,
  metadata = sample_metadata,
  vars_to_test = c("age", "sex", "treatment", "bmi"),
  id_col = "sample_id",
  min_var_explained = 5
)

# View significant associations
associations[associations$p_adj < 0.05, ]
}

}
\seealso{
\code{\link[=plot_pc_metadata_associations]{plot_pc_metadata_associations()}} for visualising results
}
